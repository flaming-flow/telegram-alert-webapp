module.exports=[72558,a=>{"use strict";var b=a.i(87924),c=a.i(72131);function d({dict:a}){let[d,e]=(0,c.useState)("phone"),[f,g]=(0,c.useState)(""),[h,i]=(0,c.useState)(""),[j,k]=(0,c.useState)(""),[l,m]=(0,c.useState)(""),[n,o]=(0,c.useState)(""),[p,q]=(0,c.useState)(""),[r,s]=(0,c.useState)(!1),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(!1),[x,y]=(0,c.useState)([]),z=a=>{console.log(a),y(b=>[...b,`${new Date().toLocaleTimeString()}: ${a}`])};(0,c.useEffect)(()=>{let a=window.Telegram?.WebApp;if(z(`WebApp: tg=${!!a}, initData=${!!a?.initData}, platform=${a?.platform}`),a){z("Calling expand() and ready()");try{a.expand?.(),a.ready?.(),z("expand/ready called")}catch(a){z(`expand error: ${a}`)}"function"==typeof a.sendData?(w(!0),z("isWebApp = true")):z("sendData not a function")}else z("No Telegram object");let b=localStorage.getItem("auth_phone"),c=localStorage.getItem("auth_sessionId");b&&c&&(g(b),m(c),e("code"))},[]);let A=async b=>{if(b.preventDefault(),q(""),!f.trim())return void q(a.errors.phoneRequired);if(!f.startsWith("+"))return void q(a.errors.phoneFormat);s(!0);try{let a=await fetch("/api/init",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:f})}),b=await a.json();b.error?q(b.error):(m(b.sessionId),localStorage.setItem("auth_phone",f),localStorage.setItem("auth_sessionId",b.sessionId),e("code"))}catch{q("Network error. Please try again.")}s(!1)},B=async b=>{if(b.preventDefault(),q(""),!h.trim())return void q(a.errors.codeRequired);s(!0);try{let a=await fetch("/api/code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:l,code:h})}),b=await a.json();b.error?q(b.error):b.needs2FA?e("password"):E(b.session)}catch{q("Network error. Please try again.")}s(!1)},C=async b=>{if(b.preventDefault(),q(""),!j)return void q(a.errors.passwordRequired);s(!0);try{let a=await fetch("/api/password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:l,password:j})}),b=await a.json();b.error?q(b.error):E(b.session)}catch{q("Network error. Please try again.")}s(!1)},D=a=>{let b=window.Telegram?.WebApp,c=a||n;if(z(`sendToBot: tg=${!!b}, session=${c?.length||0} chars`),b&&c)try{z("Calling sendData..."),b.sendData(c),z("sendData OK, calling close in 500ms"),setTimeout(()=>{z("Calling close()"),b.close()},500)}catch(a){z(`sendData error: ${a}`),e("success")}else z("Fallback to success screen"),e("success")},E=a=>{z(`handleAuthSuccess: isWebApp=${v}, session=${a.length} chars`),localStorage.removeItem("auth_phone"),localStorage.removeItem("auth_sessionId"),o(a),v?(z("Showing sending screen, will call sendToBot in 1.5s"),e("sending"),setTimeout(()=>{D(a)},1500)):(z("Not WebApp, showing success screen"),e("success"))},F=()=>{switch(d){case"phone":return 1;case"code":case"password":return 2;case"sending":case"success":return 3}};return(0,b.jsxs)("div",{className:"card p-6 w-full max-w-sm mx-auto",children:[(0,b.jsxs)("div",{className:"text-center mb-6",children:[(0,b.jsx)("h1",{className:"text-xl font-semibold text-[var(--text-primary)] mb-1",children:a.title}),(0,b.jsx)("p",{className:"text-sm text-[var(--text-secondary)]",children:a.subtitle})]}),(0,b.jsx)("div",{className:"flex justify-center gap-2 mb-6",children:[1,2,3].map(a=>(0,b.jsx)("div",{className:`w-2 h-2 rounded-full transition-colors ${a<F()?"bg-green-500":a===F()?"bg-[var(--accent)]":"bg-[var(--bg-tertiary)]"}`},a))}),x.length>0&&(0,b.jsx)("div",{className:"mb-4 p-2 bg-black/50 rounded text-xs text-green-400 font-mono max-h-32 overflow-auto",children:x.map((a,c)=>(0,b.jsx)("div",{children:a},c))}),"success"!==d&&(0,b.jsx)("div",{className:"info-box mb-5 text-sm",children:a.info}),p&&(0,b.jsx)("div",{className:"error-box mb-5",children:p}),"phone"===d&&(0,b.jsxs)("form",{onSubmit:A,children:[(0,b.jsxs)("div",{className:"mb-5",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:a.phone.label}),(0,b.jsx)("input",{type:"tel",value:f,onChange:a=>g(a.target.value),placeholder:a.phone.placeholder,autoFocus:!0}),(0,b.jsx)("p",{className:"hint mt-2",children:a.phone.hint})]}),(0,b.jsxs)("button",{type:"submit",className:"btn-primary w-full",disabled:r,children:[r?(0,b.jsx)("span",{className:"spinner"}):null,a.buttons.sendCode]})]}),"code"===d&&(0,b.jsxs)("form",{onSubmit:B,children:[(0,b.jsx)("div",{className:"mb-3 text-center text-sm text-[var(--text-secondary)]",children:f}),(0,b.jsxs)("div",{className:"mb-5",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:a.code.label}),(0,b.jsx)("input",{type:"text",value:h,onChange:a=>i(a.target.value),placeholder:a.code.placeholder,maxLength:5,className:"text-center text-xl tracking-[0.3em]",autoFocus:!0}),(0,b.jsx)("p",{className:"hint mt-2",children:a.code.hint})]}),(0,b.jsxs)("button",{type:"submit",className:"btn-primary w-full mb-2",disabled:r,children:[r?(0,b.jsx)("span",{className:"spinner"}):null,a.buttons.verify]}),(0,b.jsx)("button",{type:"button",onClick:()=>{localStorage.removeItem("auth_phone"),localStorage.removeItem("auth_sessionId"),g(""),m(""),i(""),e("phone")},className:"btn-secondary w-full",children:a.buttons.back})]}),"password"===d&&(0,b.jsxs)("form",{onSubmit:C,children:[(0,b.jsxs)("div",{className:"mb-5",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:a.password.label}),(0,b.jsx)("input",{type:"password",value:j,onChange:a=>k(a.target.value),placeholder:a.password.placeholder,autoFocus:!0}),(0,b.jsx)("p",{className:"hint mt-2",children:a.password.hint})]}),(0,b.jsxs)("button",{type:"submit",className:"btn-primary w-full",disabled:r,children:[r?(0,b.jsx)("span",{className:"spinner"}):null,a.buttons.submit]})]}),"sending"===d&&(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)("div",{className:"text-5xl mb-4",children:"✅"}),(0,b.jsx)("h2",{className:"text-xl font-semibold text-[var(--text-primary)] mb-2",children:"Авторизация успешна!"}),(0,b.jsx)("p",{className:"text-[var(--text-secondary)] mb-4",children:"Отправляю данные боту..."}),(0,b.jsx)("span",{className:"spinner"})]}),"success"===d&&(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"success-box mb-5 text-center",children:a.success.title}),(0,b.jsx)("label",{className:"block text-sm font-medium text-[var(--text-secondary)] mb-2",children:a.success.sessionLabel}),(0,b.jsx)("div",{className:"bg-[var(--bg-tertiary)] p-3 rounded-lg mb-5 font-mono text-xs break-all max-h-32 overflow-auto text-[var(--text-secondary)]",children:n}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(n),u(!0),setTimeout(()=>u(!1),2e3)},className:"btn-primary w-full",children:t?a.success.copied:a.success.copy}),v&&(0,b.jsx)("button",{onClick:()=>D(),className:"w-full py-3 px-4 rounded-xl font-medium text-sm text-white transition-all hover:opacity-90",style:{background:"linear-gradient(135deg, #2AABEE 0%, #229ED9 100%)"},children:a.success.sendToBot}),(0,b.jsx)("button",{onClick:()=>{let a=new Blob([n],{type:"text/plain"}),b=URL.createObjectURL(a),c=document.createElement("a");c.href=b,c.download="telegram-session.txt",c.click(),URL.revokeObjectURL(b)},className:"btn-secondary w-full",children:a.success.download})]})]})]})}a.s(["default",()=>d])}];

//# sourceMappingURL=components_auth_AuthForm_tsx_8bbda6bc._.js.map