{"version":3,"sources":["../../../../components/auth/AuthForm.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\n\ninterface AuthDict {\n  title: string;\n  subtitle: string;\n  info: string;\n  phone: {\n    label: string;\n    placeholder: string;\n    hint: string;\n  };\n  code: {\n    label: string;\n    placeholder: string;\n    hint: string;\n  };\n  password: {\n    label: string;\n    placeholder: string;\n    hint: string;\n  };\n  buttons: {\n    sendCode: string;\n    verify: string;\n    submit: string;\n    back: string;\n  };\n  success: {\n    title: string;\n    sessionLabel: string;\n    copy: string;\n    copied: string;\n    sendToBot: string;\n    download: string;\n  };\n  errors: {\n    phoneRequired: string;\n    phoneFormat: string;\n    codeRequired: string;\n    passwordRequired: string;\n    sessionExpired: string;\n  };\n}\n\ninterface AuthFormProps {\n  dict: AuthDict;\n}\n\ntype Step = 'phone' | 'code' | 'password' | 'success';\n\nexport default function AuthForm({ dict }: AuthFormProps) {\n  const [step, setStep] = useState<Step>('phone');\n  const [phone, setPhone] = useState('');\n  const [code, setCode] = useState('');\n  const [password, setPassword] = useState('');\n  const [sessionId, setSessionId] = useState('');\n  const [sessionString, setSessionString] = useState('');\n  const [error, setError] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [copied, setCopied] = useState(false);\n  const [isWebApp, setIsWebApp] = useState(false);\n\n  useEffect(() => {\n    // Check if running in Telegram WebApp\n    const tg = (window as unknown as { Telegram?: { WebApp?: { initData?: string } } }).Telegram?.WebApp;\n    if (tg?.initData) {\n      setIsWebApp(true);\n    }\n  }, []);\n\n  const handlePhoneSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n\n    if (!phone.trim()) {\n      setError(dict.errors.phoneRequired);\n      return;\n    }\n\n    if (!phone.startsWith('+')) {\n      setError(dict.errors.phoneFormat);\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const res = await fetch('/api/init', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ phone }),\n      });\n      const data = await res.json();\n\n      if (data.error) {\n        setError(data.error);\n      } else {\n        setSessionId(data.sessionId);\n        setStep('code');\n      }\n    } catch {\n      setError('Network error. Please try again.');\n    }\n    setLoading(false);\n  };\n\n  const handleCodeSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n\n    if (!code.trim()) {\n      setError(dict.errors.codeRequired);\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const res = await fetch('/api/code', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ sessionId, code }),\n      });\n      const data = await res.json();\n\n      if (data.error) {\n        setError(data.error);\n      } else if (data.needs2FA) {\n        setStep('password');\n      } else {\n        setSessionString(data.session);\n        setStep('success');\n      }\n    } catch {\n      setError('Network error. Please try again.');\n    }\n    setLoading(false);\n  };\n\n  const handlePasswordSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n\n    if (!password) {\n      setError(dict.errors.passwordRequired);\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const res = await fetch('/api/password', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ sessionId, password }),\n      });\n      const data = await res.json();\n\n      if (data.error) {\n        setError(data.error);\n      } else {\n        setSessionString(data.session);\n        setStep('success');\n      }\n    } catch {\n      setError('Network error. Please try again.');\n    }\n    setLoading(false);\n  };\n\n  const copyToClipboard = () => {\n    navigator.clipboard.writeText(sessionString);\n    setCopied(true);\n    setTimeout(() => setCopied(false), 2000);\n  };\n\n  const downloadSession = () => {\n    const blob = new Blob([sessionString], { type: 'text/plain' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = 'telegram-session.txt';\n    a.click();\n    URL.revokeObjectURL(url);\n  };\n\n  const sendToBot = () => {\n    const tg = (window as unknown as { Telegram?: { WebApp?: { sendData: (data: string) => void; close: () => void } } }).Telegram?.WebApp;\n    if (tg && sessionString) {\n      tg.sendData(sessionString);\n      tg.close();\n    }\n  };\n\n  const getStepNumber = () => {\n    switch (step) {\n      case 'phone': return 1;\n      case 'code': return 2;\n      case 'password': return 2;\n      case 'success': return 3;\n    }\n  };\n\n  return (\n    <div className=\"card p-6 w-full max-w-sm mx-auto\">\n      <div className=\"text-center mb-6\">\n        <h1 className=\"text-xl font-semibold text-[var(--text-primary)] mb-1\">\n          {dict.title}\n        </h1>\n        <p className=\"text-sm text-[var(--text-secondary)]\">\n          {dict.subtitle}\n        </p>\n      </div>\n\n      {/* Step indicator */}\n      <div className=\"flex justify-center gap-2 mb-6\">\n        {[1, 2, 3].map((n) => (\n          <div\n            key={n}\n            className={`w-2 h-2 rounded-full transition-colors ${\n              n < getStepNumber()\n                ? 'bg-green-500'\n                : n === getStepNumber()\n                ? 'bg-[var(--accent)]'\n                : 'bg-[var(--bg-tertiary)]'\n            }`}\n          />\n        ))}\n      </div>\n\n      {/* Info box */}\n      {step !== 'success' && (\n        <div className=\"info-box mb-5 text-sm\">\n          {dict.info}\n        </div>\n      )}\n\n      {/* Error message */}\n      {error && (\n        <div className=\"error-box mb-5\">\n          {error}\n        </div>\n      )}\n\n      {/* Phone step */}\n      {step === 'phone' && (\n        <form onSubmit={handlePhoneSubmit}>\n          <div className=\"mb-5\">\n            <label className=\"block text-sm font-medium text-[var(--text-secondary)] mb-2\">\n              {dict.phone.label}\n            </label>\n            <input\n              type=\"tel\"\n              value={phone}\n              onChange={(e) => setPhone(e.target.value)}\n              placeholder={dict.phone.placeholder}\n              autoFocus\n            />\n            <p className=\"hint mt-2\">{dict.phone.hint}</p>\n          </div>\n          <button type=\"submit\" className=\"btn-primary w-full\" disabled={loading}>\n            {loading ? <span className=\"spinner\" /> : null}\n            {dict.buttons.sendCode}\n          </button>\n        </form>\n      )}\n\n      {/* Code step */}\n      {step === 'code' && (\n        <form onSubmit={handleCodeSubmit}>\n          <div className=\"mb-5\">\n            <label className=\"block text-sm font-medium text-[var(--text-secondary)] mb-2\">\n              {dict.code.label}\n            </label>\n            <input\n              type=\"text\"\n              value={code}\n              onChange={(e) => setCode(e.target.value)}\n              placeholder={dict.code.placeholder}\n              maxLength={5}\n              className=\"text-center text-xl tracking-[0.3em]\"\n              autoFocus\n            />\n            <p className=\"hint mt-2\">{dict.code.hint}</p>\n          </div>\n          <button type=\"submit\" className=\"btn-primary w-full\" disabled={loading}>\n            {loading ? <span className=\"spinner\" /> : null}\n            {dict.buttons.verify}\n          </button>\n        </form>\n      )}\n\n      {/* Password step */}\n      {step === 'password' && (\n        <form onSubmit={handlePasswordSubmit}>\n          <div className=\"mb-5\">\n            <label className=\"block text-sm font-medium text-[var(--text-secondary)] mb-2\">\n              {dict.password.label}\n            </label>\n            <input\n              type=\"password\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n              placeholder={dict.password.placeholder}\n              autoFocus\n            />\n            <p className=\"hint mt-2\">{dict.password.hint}</p>\n          </div>\n          <button type=\"submit\" className=\"btn-primary w-full\" disabled={loading}>\n            {loading ? <span className=\"spinner\" /> : null}\n            {dict.buttons.submit}\n          </button>\n        </form>\n      )}\n\n      {/* Success step */}\n      {step === 'success' && (\n        <div>\n          <div className=\"success-box mb-5 text-center\">\n            {dict.success.title}\n          </div>\n\n          <label className=\"block text-sm font-medium text-[var(--text-secondary)] mb-2\">\n            {dict.success.sessionLabel}\n          </label>\n          <div className=\"bg-[var(--bg-tertiary)] p-3 rounded-lg mb-5 font-mono text-xs break-all max-h-32 overflow-auto text-[var(--text-secondary)]\">\n            {sessionString}\n          </div>\n\n          <div className=\"space-y-2\">\n            <button onClick={copyToClipboard} className=\"btn-primary w-full\">\n              {copied ? dict.success.copied : dict.success.copy}\n            </button>\n\n            {isWebApp && (\n              <button\n                onClick={sendToBot}\n                className=\"w-full py-3 px-4 rounded-xl font-medium text-sm text-white transition-all hover:opacity-90\"\n                style={{ background: 'linear-gradient(135deg, #2AABEE 0%, #229ED9 100%)' }}\n              >\n                {dict.success.sendToBot}\n              </button>\n            )}\n\n            <button onClick={downloadSession} className=\"btn-secondary w-full\">\n              {dict.success.download}\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}