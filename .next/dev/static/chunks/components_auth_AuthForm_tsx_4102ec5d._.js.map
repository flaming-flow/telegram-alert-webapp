{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/daniil/Documents/dev/telegram-session-auth/components/auth/AuthForm.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\n\ninterface AuthDict {\n  title: string;\n  subtitle: string;\n  info: string;\n  phone: {\n    label: string;\n    placeholder: string;\n    hint: string;\n  };\n  code: {\n    label: string;\n    placeholder: string;\n    hint: string;\n  };\n  password: {\n    label: string;\n    placeholder: string;\n    hint: string;\n  };\n  buttons: {\n    sendCode: string;\n    verify: string;\n    submit: string;\n    back: string;\n  };\n  success: {\n    title: string;\n    sessionLabel: string;\n    copy: string;\n    copied: string;\n    sendToBot: string;\n    download: string;\n  };\n  errors: {\n    phoneRequired: string;\n    phoneFormat: string;\n    codeRequired: string;\n    passwordRequired: string;\n    sessionExpired: string;\n  };\n}\n\ninterface AuthFormProps {\n  dict: AuthDict;\n}\n\ntype Step = 'phone' | 'code' | 'password' | 'success';\n\nexport default function AuthForm({ dict }: AuthFormProps) {\n  const [step, setStep] = useState<Step>('phone');\n  const [phone, setPhone] = useState('');\n  const [code, setCode] = useState('');\n  const [password, setPassword] = useState('');\n  const [sessionId, setSessionId] = useState('');\n  const [sessionString, setSessionString] = useState('');\n  const [error, setError] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [copied, setCopied] = useState(false);\n  const [isWebApp, setIsWebApp] = useState(false);\n\n  useEffect(() => {\n    // Check if running in Telegram WebApp\n    const tg = (window as unknown as { Telegram?: { WebApp?: { initData?: string } } }).Telegram?.WebApp;\n    if (tg?.initData) {\n      setIsWebApp(true);\n    }\n  }, []);\n\n  const handlePhoneSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n\n    if (!phone.trim()) {\n      setError(dict.errors.phoneRequired);\n      return;\n    }\n\n    if (!phone.startsWith('+')) {\n      setError(dict.errors.phoneFormat);\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const res = await fetch('/api/init', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ phone }),\n      });\n      const data = await res.json();\n\n      if (data.error) {\n        setError(data.error);\n      } else {\n        setSessionId(data.sessionId);\n        setStep('code');\n      }\n    } catch {\n      setError('Network error. Please try again.');\n    }\n    setLoading(false);\n  };\n\n  const handleCodeSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n\n    if (!code.trim()) {\n      setError(dict.errors.codeRequired);\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const res = await fetch('/api/code', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ sessionId, code }),\n      });\n      const data = await res.json();\n\n      if (data.error) {\n        setError(data.error);\n      } else if (data.needs2FA) {\n        setStep('password');\n      } else {\n        setSessionString(data.session);\n        setStep('success');\n      }\n    } catch {\n      setError('Network error. Please try again.');\n    }\n    setLoading(false);\n  };\n\n  const handlePasswordSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n\n    if (!password) {\n      setError(dict.errors.passwordRequired);\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const res = await fetch('/api/password', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ sessionId, password }),\n      });\n      const data = await res.json();\n\n      if (data.error) {\n        setError(data.error);\n      } else {\n        setSessionString(data.session);\n        setStep('success');\n      }\n    } catch {\n      setError('Network error. Please try again.');\n    }\n    setLoading(false);\n  };\n\n  const copyToClipboard = () => {\n    navigator.clipboard.writeText(sessionString);\n    setCopied(true);\n    setTimeout(() => setCopied(false), 2000);\n  };\n\n  const downloadSession = () => {\n    const blob = new Blob([sessionString], { type: 'text/plain' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = 'telegram-session.txt';\n    a.click();\n    URL.revokeObjectURL(url);\n  };\n\n  const sendToBot = () => {\n    const tg = (window as unknown as { Telegram?: { WebApp?: { sendData: (data: string) => void; close: () => void } } }).Telegram?.WebApp;\n    if (tg && sessionString) {\n      tg.sendData(sessionString);\n      tg.close();\n    }\n  };\n\n  const getStepNumber = () => {\n    switch (step) {\n      case 'phone': return 1;\n      case 'code': return 2;\n      case 'password': return 2;\n      case 'success': return 3;\n    }\n  };\n\n  return (\n    <div className=\"card p-6 w-full max-w-sm mx-auto\">\n      <div className=\"text-center mb-6\">\n        <h1 className=\"text-xl font-semibold text-[var(--text-primary)] mb-1\">\n          {dict.title}\n        </h1>\n        <p className=\"text-sm text-[var(--text-secondary)]\">\n          {dict.subtitle}\n        </p>\n      </div>\n\n      {/* Step indicator */}\n      <div className=\"flex justify-center gap-2 mb-6\">\n        {[1, 2, 3].map((n) => (\n          <div\n            key={n}\n            className={`w-2 h-2 rounded-full transition-colors ${\n              n < getStepNumber()\n                ? 'bg-green-500'\n                : n === getStepNumber()\n                ? 'bg-[var(--accent)]'\n                : 'bg-[var(--bg-tertiary)]'\n            }`}\n          />\n        ))}\n      </div>\n\n      {/* Info box */}\n      {step !== 'success' && (\n        <div className=\"info-box mb-5 text-sm\">\n          {dict.info}\n        </div>\n      )}\n\n      {/* Error message */}\n      {error && (\n        <div className=\"error-box mb-5\">\n          {error}\n        </div>\n      )}\n\n      {/* Phone step */}\n      {step === 'phone' && (\n        <form onSubmit={handlePhoneSubmit}>\n          <div className=\"mb-5\">\n            <label className=\"block text-sm font-medium text-[var(--text-secondary)] mb-2\">\n              {dict.phone.label}\n            </label>\n            <input\n              type=\"tel\"\n              value={phone}\n              onChange={(e) => setPhone(e.target.value)}\n              placeholder={dict.phone.placeholder}\n              autoFocus\n            />\n            <p className=\"hint mt-2\">{dict.phone.hint}</p>\n          </div>\n          <button type=\"submit\" className=\"btn-primary w-full\" disabled={loading}>\n            {loading ? <span className=\"spinner\" /> : null}\n            {dict.buttons.sendCode}\n          </button>\n        </form>\n      )}\n\n      {/* Code step */}\n      {step === 'code' && (\n        <form onSubmit={handleCodeSubmit}>\n          <div className=\"mb-5\">\n            <label className=\"block text-sm font-medium text-[var(--text-secondary)] mb-2\">\n              {dict.code.label}\n            </label>\n            <input\n              type=\"text\"\n              value={code}\n              onChange={(e) => setCode(e.target.value)}\n              placeholder={dict.code.placeholder}\n              maxLength={5}\n              className=\"text-center text-xl tracking-[0.3em]\"\n              autoFocus\n            />\n            <p className=\"hint mt-2\">{dict.code.hint}</p>\n          </div>\n          <button type=\"submit\" className=\"btn-primary w-full\" disabled={loading}>\n            {loading ? <span className=\"spinner\" /> : null}\n            {dict.buttons.verify}\n          </button>\n        </form>\n      )}\n\n      {/* Password step */}\n      {step === 'password' && (\n        <form onSubmit={handlePasswordSubmit}>\n          <div className=\"mb-5\">\n            <label className=\"block text-sm font-medium text-[var(--text-secondary)] mb-2\">\n              {dict.password.label}\n            </label>\n            <input\n              type=\"password\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n              placeholder={dict.password.placeholder}\n              autoFocus\n            />\n            <p className=\"hint mt-2\">{dict.password.hint}</p>\n          </div>\n          <button type=\"submit\" className=\"btn-primary w-full\" disabled={loading}>\n            {loading ? <span className=\"spinner\" /> : null}\n            {dict.buttons.submit}\n          </button>\n        </form>\n      )}\n\n      {/* Success step */}\n      {step === 'success' && (\n        <div>\n          <div className=\"success-box mb-5 text-center\">\n            {dict.success.title}\n          </div>\n\n          <label className=\"block text-sm font-medium text-[var(--text-secondary)] mb-2\">\n            {dict.success.sessionLabel}\n          </label>\n          <div className=\"bg-[var(--bg-tertiary)] p-3 rounded-lg mb-5 font-mono text-xs break-all max-h-32 overflow-auto text-[var(--text-secondary)]\">\n            {sessionString}\n          </div>\n\n          <div className=\"space-y-2\">\n            <button onClick={copyToClipboard} className=\"btn-primary w-full\">\n              {copied ? dict.success.copied : dict.success.copy}\n            </button>\n\n            {isWebApp && (\n              <button\n                onClick={sendToBot}\n                className=\"w-full py-3 px-4 rounded-xl font-medium text-sm text-white transition-all hover:opacity-90\"\n                style={{ background: 'linear-gradient(135deg, #2AABEE 0%, #229ED9 100%)' }}\n              >\n                {dict.success.sendToBot}\n              </button>\n            )}\n\n            <button onClick={downloadSession} className=\"btn-secondary w-full\">\n              {dict.success.download}\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}