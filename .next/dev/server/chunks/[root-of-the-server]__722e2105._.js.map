{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///Users/daniil/Documents/dev/telegram-session-auth/lib/sessions.ts"],"sourcesContent":["import { TelegramClient } from 'telegram';\nimport { StringSession } from 'telegram/sessions';\n\ninterface AuthSession {\n  client: TelegramClient;\n  phoneCodeHash: string;\n  phone: string;\n  createdAt: number;\n}\n\n// In-memory session storage with TTL\nconst sessions = new Map<string, AuthSession>();\n\n// Clean up old sessions every 5 minutes\nconst SESSION_TTL = 10 * 60 * 1000; // 10 minutes\n\nsetInterval(() => {\n  const now = Date.now();\n  for (const [id, session] of sessions.entries()) {\n    if (now - session.createdAt > SESSION_TTL) {\n      session.client.disconnect().catch(() => {});\n      sessions.delete(id);\n    }\n  }\n}, 5 * 60 * 1000);\n\nexport function createSession(id: string, client: TelegramClient, phone: string, phoneCodeHash: string): void {\n  sessions.set(id, {\n    client,\n    phoneCodeHash,\n    phone,\n    createdAt: Date.now(),\n  });\n}\n\nexport function getSession(id: string): AuthSession | undefined {\n  return sessions.get(id);\n}\n\nexport function deleteSession(id: string): void {\n  const session = sessions.get(id);\n  if (session) {\n    session.client.disconnect().catch(() => {});\n    sessions.delete(id);\n  }\n}\n\nexport function generateSessionId(): string {\n  return Math.random().toString(36).substring(2) + Date.now().toString(36);\n}\n\nexport async function createTelegramClient(): Promise<TelegramClient> {\n  const apiId = parseInt(process.env.TELEGRAM_API_ID || '0');\n  const apiHash = process.env.TELEGRAM_API_HASH || '';\n\n  const client = new TelegramClient(\n    new StringSession(''),\n    apiId,\n    apiHash,\n    {\n      connectionRetries: 5,\n      deviceModel: 'Thread Hunter Web',\n      systemVersion: 'Web',\n      appVersion: '1.0.0',\n    }\n  );\n\n  await client.connect();\n  return client;\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;;;AASA,qCAAqC;AACrC,MAAM,WAAW,IAAI;AAErB,wCAAwC;AACxC,MAAM,cAAc,KAAK,KAAK,MAAM,aAAa;AAEjD,YAAY;IACV,MAAM,MAAM,KAAK,GAAG;IACpB,KAAK,MAAM,CAAC,IAAI,QAAQ,IAAI,SAAS,OAAO,GAAI;QAC9C,IAAI,MAAM,QAAQ,SAAS,GAAG,aAAa;YACzC,QAAQ,MAAM,CAAC,UAAU,GAAG,KAAK,CAAC,KAAO;YACzC,SAAS,MAAM,CAAC;QAClB;IACF;AACF,GAAG,IAAI,KAAK;AAEL,SAAS,cAAc,EAAU,EAAE,MAAsB,EAAE,KAAa,EAAE,aAAqB;IACpG,SAAS,GAAG,CAAC,IAAI;QACf;QACA;QACA;QACA,WAAW,KAAK,GAAG;IACrB;AACF;AAEO,SAAS,WAAW,EAAU;IACnC,OAAO,SAAS,GAAG,CAAC;AACtB;AAEO,SAAS,cAAc,EAAU;IACtC,MAAM,UAAU,SAAS,GAAG,CAAC;IAC7B,IAAI,SAAS;QACX,QAAQ,MAAM,CAAC,UAAU,GAAG,KAAK,CAAC,KAAO;QACzC,SAAS,MAAM,CAAC;IAClB;AACF;AAEO,SAAS;IACd,OAAO,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,KAAK,KAAK,GAAG,GAAG,QAAQ,CAAC;AACvE;AAEO,eAAe;IACpB,MAAM,QAAQ,SAAS,QAAQ,GAAG,CAAC,eAAe,IAAI;IACtD,MAAM,UAAU,QAAQ,GAAG,CAAC,iBAAiB,IAAI;IAEjD,MAAM,SAAS,IAAI,qJAAc,CAC/B,IAAI,gKAAa,CAAC,KAClB,OACA,SACA;QACE,mBAAmB;QACnB,aAAa;QACb,eAAe;QACf,YAAY;IACd;IAGF,MAAM,OAAO,OAAO;IACpB,OAAO;AACT"}},
    {"offset": {"line": 178, "column": 0}, "map": {"version":3,"sources":["file:///Users/daniil/Documents/dev/telegram-session-auth/app/api/init/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { Api } from 'telegram';\nimport { createTelegramClient, createSession, generateSessionId } from '@/lib/sessions';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { phone } = await request.json();\n\n    if (!phone || typeof phone !== 'string') {\n      return NextResponse.json({ error: 'Phone number is required' }, { status: 400 });\n    }\n\n    const client = await createTelegramClient();\n\n    const result = await client.invoke(\n      new Api.auth.SendCode({\n        phoneNumber: phone,\n        apiId: parseInt(process.env.TELEGRAM_API_ID || '0'),\n        apiHash: process.env.TELEGRAM_API_HASH || '',\n        settings: new Api.CodeSettings({\n          allowFlashcall: false,\n          currentNumber: false,\n          allowAppHash: false,\n        }),\n      })\n    );\n\n    // Type guard for SentCode vs SentCodeSuccess\n    if (!('phoneCodeHash' in result)) {\n      return NextResponse.json({ error: 'Unexpected response from Telegram' }, { status: 500 });\n    }\n\n    const sessionId = generateSessionId();\n    createSession(sessionId, client, phone, result.phoneCodeHash);\n\n    return NextResponse.json({ sessionId });\n  } catch (error) {\n    console.error('Init error:', error);\n\n    const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n\n    if (errorMessage.includes('PHONE_NUMBER_INVALID')) {\n      return NextResponse.json({ error: 'Invalid phone number format' }, { status: 400 });\n    }\n    if (errorMessage.includes('PHONE_NUMBER_BANNED')) {\n      return NextResponse.json({ error: 'This phone number is banned' }, { status: 400 });\n    }\n    if (errorMessage.includes('FLOOD')) {\n      return NextResponse.json({ error: 'Too many attempts. Please try again later.' }, { status: 429 });\n    }\n\n    return NextResponse.json({ error: 'Failed to send code. Please try again.' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEpC,IAAI,CAAC,SAAS,OAAO,UAAU,UAAU;YACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA2B,GAAG;gBAAE,QAAQ;YAAI;QAChF;QAEA,MAAM,SAAS,MAAM,IAAA,yIAAoB;QAEzC,MAAM,SAAS,MAAM,OAAO,MAAM,CAChC,IAAI,0IAAG,CAAC,IAAI,CAAC,QAAQ,CAAC;YACpB,aAAa;YACb,OAAO,SAAS,QAAQ,GAAG,CAAC,eAAe,IAAI;YAC/C,SAAS,QAAQ,GAAG,CAAC,iBAAiB,IAAI;YAC1C,UAAU,IAAI,0IAAG,CAAC,YAAY,CAAC;gBAC7B,gBAAgB;gBAChB,eAAe;gBACf,cAAc;YAChB;QACF;QAGF,6CAA6C;QAC7C,IAAI,CAAC,CAAC,mBAAmB,MAAM,GAAG;YAChC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoC,GAAG;gBAAE,QAAQ;YAAI;QACzF;QAEA,MAAM,YAAY,IAAA,sIAAiB;QACnC,IAAA,kIAAa,EAAC,WAAW,QAAQ,OAAO,OAAO,aAAa;QAE5D,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAU;IACvC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,eAAe;QAE7B,MAAM,eAAe,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAE9D,IAAI,aAAa,QAAQ,CAAC,yBAAyB;YACjD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA8B,GAAG;gBAAE,QAAQ;YAAI;QACnF;QACA,IAAI,aAAa,QAAQ,CAAC,wBAAwB;YAChD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA8B,GAAG;gBAAE,QAAQ;YAAI;QACnF;QACA,IAAI,aAAa,QAAQ,CAAC,UAAU;YAClC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA6C,GAAG;gBAAE,QAAQ;YAAI;QAClG;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAyC,GAAG;YAAE,QAAQ;QAAI;IAC9F;AACF"}}]
}